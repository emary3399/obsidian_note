## 事务
2022 年试题五（共 15 分）
阅读下列说明，回答问题 1 至问题 4，将解答填入答题纸的对应栏内。
【说明】 
某数据库系统采用数据转储方式对数据和日志文件进行离线备份，用检查点机制进行恢复。假设其部分日志文件如表 5-1 所示。日志记录内容中：CHECKPOINT 表示检查点，表示事务 Ti 开始执行，表示事务 Ti 提交，表示事务Ti 将数据项D的值由V1 修改为 V2。CRASH 表明系统发生断电故障。假设各数据项的初始值为：I=3，J=6，K=11。

表 5-1 日志记录列表 

| 日志记录编号 | 日志记录内容      |
|--------------|------------------|
| LSN1         | <T1, START>      |
| LSN2         | <T1, I, 3, 5>    |
| LSN3         | <T2, START>      |
| LSN4         | <T1, J, 6, 7>    |
| LSN5         | <T2, I, 5, 4>    |
| LSN6         | <T1, COMMIT>     |
| LSN7         | CHECKPOINT       |
| LSN8         | <T2, J, 7, 8>    |
| LSN9         | <T3, START>      |
| LSN10        | <T3, K, 11, 18>  |
| LSN11        | <T4, START>      |
| LSN12        | <T4, K, 18, 19>  |
| LSN13        | <T2, COMMIT>     |
| LSN14        | CRASH            |

【问题 1】（4 分） 系统发生故障时，满足持久化要求的事务有哪些？不满足持久化要求的事务有哪些？
满足持久化要求的事务：T1，T2
不满足持久化要求的事务：T3，T4

【问题 2】（6 分） 系统恢复后，数据项 I、J、K 的数值哪些会恢复为初始值？哪些不会恢复为初始值？请给出系统恢复后 I、J、K 的值。
系统恢复后，k会恢复初始值；I,J不会恢复。
系统恢复后： I=4、J=8、K =11。

【问题 3】（3 分） 如果系统采用先写数据库再记日志的机制，故障发生前已经提交了事务T2，但没有记录到。请给出系统恢复后 I、J、K 的值。
 I=5、J=7、K =11。


【问题 4】（2 分） 基于问题 2 和问题 3 的结果，请用 50 字以内的文字简要说明为什么先写日志机制更优。先写日志  
1. **保证原子性**：日志记录成功后事务才算提交  
2. **提升性能**：避免每次写数据都刷盘  
3. **快速恢复**：通过日志重做/回滚  
4. **数据安全**：日志完整则数据可恢复  

